{"version":3,"file":"jquery-state-store.min.js","sources":["../src/index.js"],"sourcesContent":["(function($) {\r\n  var stateStore = {};\r\n  var listeners = {};\r\n  var effects = {};\r\n\r\n  function createReactiveObject(stateName, initialState) {\r\n      return new Proxy(initialState, {\r\n          set(target, key, value) {\r\n              target[key] = value;\r\n              notifyListeners(stateName);\r\n              notifyEffects(stateName);\r\n              return true;\r\n          },\r\n          get(target, key) {\r\n              if (typeof target[key] === 'object' && target[key] !== null) {\r\n                  return createReactiveObject(stateName, target[key]);\r\n              }\r\n              return target[key];\r\n          }\r\n      });\r\n  }\r\n\r\n  function useState(name, initialValue) {\r\n      if (!stateStore.hasOwnProperty(name)) {\r\n          if (typeof initialValue === 'object' && initialValue !== null) {\r\n              stateStore[name] = createReactiveObject(name, initialValue);\r\n          } else {\r\n              stateStore[name] = initialValue;\r\n          }\r\n          listeners[name] = [];\r\n          effects[name] = [];\r\n          bindElements(name);\r\n      } else {\r\n          console.warn(`State \"${name}\" is already registered.`);\r\n      }\r\n  }\r\n\r\n  function getState(path) {\r\n      var keys = path.split('.');\r\n      var state = stateStore;\r\n      for (var i = 0; i < keys.length; i++) {\r\n          if (state[keys[i]] === undefined) {\r\n              return undefined;\r\n          }\r\n          state = state[keys[i]];\r\n      }\r\n      return state;\r\n  }\r\n\r\n  function setState(path, newValue) {\r\n      var keys = path.split('.');\r\n      var state = stateStore;\r\n      for (var i = 0; i < keys.length - 1; i++) {\r\n          if (state[keys[i]] === undefined) {\r\n              state[keys[i]] = {};\r\n          }\r\n          state = state[keys[i]];\r\n      }\r\n      var lastKey = keys[keys.length - 1];\r\n      state[lastKey] = newValue;\r\n      notifyListeners(keys[0]);\r\n      notifyEffects(keys[0]);\r\n  }\r\n\r\n  function reactive(path, listener) {\r\n      var keys = path.split('.');\r\n      var name = keys[0];\r\n      if (listeners.hasOwnProperty(name)) {\r\n          listeners[name].push(listener);\r\n      } else {\r\n          console.warn(`State \"${name}\" is not registered.`);\r\n      }\r\n  }\r\n\r\n  function notifyListeners(name) {\r\n      if (listeners.hasOwnProperty(name)) {\r\n          listeners[name].forEach(function(listener) {\r\n              listener(getState(name));\r\n          });\r\n      }\r\n  }\r\n\r\n  function useEffect(name, effect) {\r\n      var keys = name.split('.');\r\n      var topState = keys[0];\r\n      if (effects.hasOwnProperty(topState)) {\r\n          effects[topState].push({ path: name, effect: effect });\r\n          effect(getState(name));\r\n      } else {\r\n          console.warn(`State \"${name}\" is not registered.`);\r\n      }\r\n  }\r\n\r\n  function notifyEffects(name) {\r\n      if (effects.hasOwnProperty(name)) {\r\n          effects[name].forEach(function(effectObj) {\r\n              effectObj.effect(getState(effectObj.path));\r\n          });\r\n      }\r\n  }\r\n\r\n  function bindElements(stateName) {\r\n      $('[data-bind]').each(function() {\r\n          var element = $(this);\r\n          var bindings = element.data('bind').split(';');\r\n\r\n          bindings.forEach(function(binding) {\r\n              var parts = binding.split(':');\r\n              var directive = parts[0].trim();\r\n              var stateKey = parts[1].trim();\r\n\r\n              if (stateKey.startsWith(stateName)) {\r\n                  switch (directive) {\r\n                      case 'text':\r\n                          reactive(stateKey, function() {\r\n                              element.text(getState(stateKey));\r\n                          });\r\n                          break;\r\n                      case 'html':\r\n                          reactive(stateKey, function() {\r\n                              element.html(getState(stateKey));\r\n                          });\r\n                          break;\r\n                      case 'if':\r\n                          reactive(stateKey, function() {\r\n                              if (getState(stateKey)) {\r\n                                  element.show();\r\n                              } else {\r\n                                  element.hide();\r\n                              }\r\n                          });\r\n                          break;\r\n                      case 'data':\r\n                          reactive(stateKey, function() {\r\n                              element.data('value', getState(stateKey));\r\n                          });\r\n                          break;\r\n                      case 'model':\r\n                          reactive(stateKey, function() {\r\n                              element.val(getState(stateKey));\r\n                          });\r\n                          element.on('input', function() {\r\n                              setState(stateKey, element.val());\r\n                          });\r\n                          break;\r\n                      default:\r\n                          console.warn(`Unknown directive: ${directive}`);\r\n                  }\r\n              }\r\n          });\r\n      });\r\n  }\r\n\r\n  // Expose the functions to the global jQuery object\r\n  $.useState = useState;\r\n  $.getState = getState;\r\n  $.setState = setState;\r\n  $.reactive = reactive;\r\n  $.useEffect = useEffect;\r\n})(jQuery);\r\n\r\n$(document).ready(function() {\r\n  $('[data-bind]').each(function() {\r\n    var element = $(this);\r\n    var bindings = element.data('bind').split(';');\r\n\r\n    bindings.forEach(function(binding) {\r\n        var parts = binding.split(':');\r\n        var directive = parts[0].trim();\r\n        var stateKey = parts[1].trim();\r\n        var initialValue = $.getState(stateKey);\r\n\r\n        switch (directive) {\r\n            case 'text':\r\n                element.text(initialValue);\r\n                break;\r\n            case 'html':\r\n                element.html(initialValue);\r\n                break;\r\n            case 'if':\r\n                if (initialValue) {\r\n                    element.show();\r\n                } else {\r\n                    element.hide();\r\n                }\r\n                break;\r\n            case 'data':\r\n                element.data('value', initialValue);\r\n                break;\r\n            case 'model':\r\n                element.val(initialValue);\r\n                element.on('input', function() {\r\n                    $.setState(stateKey, element.val());\r\n                });\r\n                break;\r\n            default:\r\n                console.warn(`Unknown directive: ${directive}`);\r\n        }\r\n    });\r\n  });\r\n})"],"names":["$","stateStore","listeners","effects","createReactiveObject","stateName","initialState","Proxy","set","target","key","value","notifyListeners","notifyEffects","get","getState","path","keys","split","state","i","length","undefined","setState","newValue","reactive","listener","name","hasOwnProperty","push","console","warn","forEach","effectObj","effect","useState","initialValue","each","element","this","data","binding","parts","directive","trim","stateKey","startsWith","text","html","show","hide","val","on","useEffect","topState","jQuery","document","ready"],"mappings":"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"}